(()=>{if(console.log("[Mindful Timer] Content script loaded."),document.getElementById("mindful-timer-overlay")){console.log("[Mindful Timer] Overlay already present. Skipping creation.");return}const t=document.createElement("div");t.id="mindful-timer-overlay",t.style.position="fixed",t.style.bottom="20px",t.style.right="20px",t.style.width="150px",t.style.background="rgba(0,0,0,0.7)",t.style.color="#fff",t.style.borderRadius="8px",t.style.padding="10px",t.style.zIndex="999999",t.style.fontFamily="sans-serif",t.style.userSelect="none",t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="center",t.style.justifyContent="flex-start",document.body.appendChild(t);const a=document.createElement("div");a.style.fontSize="18px",a.style.fontWeight="bold",a.style.marginBottom="5px",t.appendChild(a);const i=document.createElement("button");i.textContent="×",i.style.position="absolute",i.style.top="5px",i.style.right="8px",i.style.color="#fff",i.style.background="transparent",i.style.border="none",i.style.cursor="pointer",i.style.fontSize="16px",t.appendChild(i);const n=document.createElement("button");n.style.cursor="pointer",n.style.fontSize="14px",n.style.padding="6px 10px",n.style.marginTop="5px",n.style.color="#333",n.style.background="#ccc",n.style.border="1px solid #666",n.style.borderRadius="4px",n.textContent="Pause",t.appendChild(n);let s=!1;chrome.storage.onChanged.addListener((e,o)=>{if(o==="sync"&&e.timerState){const r=e.timerState.newValue;console.log("[Mindful Timer] Timer state changed:",r),l(r)}}),chrome.storage.sync.get("timerState",e=>{const o=e.timerState;o?l(o):(a.textContent="No timer running",n.textContent="Restart")}),i.addEventListener("click",()=>{t.remove(),chrome.runtime.sendMessage({action:"closeOverlay"})}),n.addEventListener("click",()=>{if(s){chrome.runtime.sendMessage({action:"globalRestart"}),s=!1,n.textContent="Pause";return}chrome.storage.sync.get("timerState",e=>{const o=e.timerState;if(!o||!o.isActive){chrome.runtime.sendMessage({action:"globalRestart"});return}o.isPaused?(chrome.runtime.sendMessage({action:"resumeTimer"}),n.textContent="Pause"):(chrome.runtime.sendMessage({action:"pauseTimer"}),n.textContent="Resume")})}),chrome.runtime.onMessage.addListener((e,o,r)=>{switch(e.action){case"timerUpdated":chrome.storage.sync.get("timerState",c=>{l(c.timerState)}),r({ack:!0});break;case"removeOverlay":t.remove(),r({ack:!0});break;case"timerCompleted":s=!0,a.textContent="Session Complete!",e.isActive&&e.soundUrl&&m(e.soundUrl),e.quote&&d(e.quote),n.textContent="Restart",r({ack:!0});break;case"timerStarted":s=!1,a.textContent="Starting...",n.textContent="Pause",r({ack:!0});break;case"timerPaused":s=!1,n.textContent="Resume",r({ack:!0});break;case"timerResumed":s=!1,n.textContent="Pause",r({ack:!0});break;case"timerReset":s=!1,a.textContent="No timer running",n.textContent="Restart",r({ack:!0});break}return!0});function l(e){if(!e||!e.isActive){a.textContent="No timer running",n.textContent="Restart";return}e.isPaused?(a.textContent=u(e.timeLeft),n.textContent="Resume"):(a.textContent=u(e.timeLeft),n.textContent="Pause")}function m(e){const o=new Audio(e);chrome.storage.sync.get("soundVolume",r=>{const c=(r.soundVolume!==void 0?r.soundVolume:100)/100;o.volume=c,o.play().catch(y=>{console.error("[Mindful Timer] Audio playback failed:",y)})})}function d(e){const o=document.createElement("div");o.className="quote-text",o.style.marginTop="5px",o.style.color="#fff",o.style.fontSize="12px",o.textContent=`“${e}”`,t.appendChild(o)}function u(e){const o=Math.floor(e/60).toString().padStart(2,"0"),r=(e%60).toString().padStart(2,"0");return`${o}:${r}`}})();

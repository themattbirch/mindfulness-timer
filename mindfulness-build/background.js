import{s as r,g as m,v as d}from"./v4.js";const s={isActive:!1,isPaused:!1,timeLeft:0,mode:"focus",interval:15};chrome.runtime.onInstalled.addListener(()=>{r({interval:15,soundEnabled:!0,notificationsEnabled:!0,theme:"light",timerState:s})});chrome.runtime.onMessage.addListener(async(e,t,a)=>{const i=(await m(["timerState"])).timerState||s;switch(e.action){case"startTimer":await l(e.interval,e.mode),a({status:"Timer started"});break;case"pauseTimer":await f(i),a({status:"Timer paused"});break;case"resumeTimer":await h(i),a({status:"Timer resumed"});break;case"resetTimer":await T(),a({status:"Timer reset"});break;case"snoozeTimer":await c(),a({status:"Timer snoozed for 5 minutes"});break;case"takeBreak":chrome.windows.create({url:chrome.runtime.getURL("index.html"),type:"popup",width:400,height:600}),a({status:"Break window opened"});break;default:a({status:"Unknown action"})}return!0});async function l(e,t){const a={isActive:!0,isPaused:!1,timeLeft:e*60,mode:t,interval:e};await r({timerState:a}),chrome.alarms.create("mindfulnessTimer",{delayInMinutes:e})}async function f(e){e.isActive&&!e.isPaused&&chrome.alarms.get("mindfulnessTimer",async t=>{if(t){const a=Date.now(),n=t.scheduledTime,i=Math.max(0,Math.floor((n-a)/1e3));if(await chrome.alarms.clear("mindfulnessTimer")){const u={...e,isPaused:!0,timeLeft:i};await r({timerState:u})}}})}async function h(e){if(e.isActive&&e.isPaused&&e.timeLeft>0){const t=e.timeLeft/60;await r({timerState:{...e,isPaused:!1}}),chrome.alarms.create("mindfulnessTimer",{delayInMinutes:t})}}async function T(){await r({timerState:s}),chrome.alarms.clear("mindfulnessTimer")}async function c(){await r({timerState:{...s,isActive:!0,timeLeft:5*60,mode:"shortBreak",interval:5}}),chrome.alarms.create("mindfulnessTimer",{delayInMinutes:5})}chrome.alarms.onAlarm.addListener(async e=>{if(e.name==="mindfulnessTimer"){const t=await m(["notificationsEnabled","soundEnabled","timerState"]),{notificationsEnabled:a}=t,n=t.timerState||s;if(n.isActive&&!n.isPaused){if(a){const i=w(),o=`mindfulnessReminder-${d()}`;chrome.notifications.create(o,{type:"basic",iconUrl:chrome.runtime.getURL("icons/icon128.png"),title:"Time for a Mindful Break",message:`${i.text} â€” ${i.author}`,buttons:[{title:"Take Break"},{title:"Snooze"}],requireInteraction:!0})}await r({timerState:s})}}});chrome.notifications.onButtonClicked.addListener(async(e,t)=>{e.startsWith("mindfulnessReminder-")&&(t===0?(chrome.runtime.sendMessage({action:"takeBreak"}),chrome.notifications.clear(e)):t===1&&(chrome.notifications.clear(e),await c()))});function w(){const e=[{text:"Take a deep breath and relax.",author:"Unknown"},{text:"Stay present and mindful.",author:"Thich Nhat Hanh"},{text:"The present moment is filled with joy and happiness. If you are attentive, you will see it.",author:"Thich Nhat Hanh"},{text:"Mindfulness isn't difficult, we just need to remember to do it.",author:"Sharon Salzberg"}];return e[Math.floor(Math.random()*e.length)]}

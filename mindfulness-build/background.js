import{s as r,g as c,v as d}from"./v4.js";const n={isActive:!1,isPaused:!1,timeLeft:0,mode:"focus",interval:15};chrome.runtime.onInstalled.addListener(()=>{r({interval:15,soundEnabled:!0,notificationsEnabled:!0,theme:"light",timerState:n})});chrome.runtime.onMessage.addListener(async(e,t,a)=>{const i=(await c(["timerState"])).timerState||n;switch(e.action){case"startTimer":await l(e.interval,e.mode),a({status:"Timer started"});break;case"pauseTimer":await f(i),a({status:"Timer paused"});break;case"resumeTimer":await h(i),a({status:"Timer resumed"});break;case"resetTimer":await T(),a({status:"Timer reset"});break;case"snoozeTimer":await u(),a({status:"Timer snoozed for 5 minutes"});break;case"takeBreak":chrome.windows.create({url:chrome.runtime.getURL("index.html"),type:"popup",width:400,height:600}),a({status:"Break window opened"});break;default:a({status:"Unknown action"})}return!0});async function l(e,t){const a={isActive:!0,isPaused:!1,timeLeft:e*60,mode:t,interval:e};await r({timerState:a}),chrome.alarms.create("mindfulnessTimer",{delayInMinutes:e})}async function f(e){e.isActive&&!e.isPaused&&chrome.alarms.get("mindfulnessTimer",async t=>{if(t){const a=Date.now(),s=t.scheduledTime,i=Math.max(0,Math.floor((s-a)/1e3));if(await chrome.alarms.clear("mindfulnessTimer")){const m={...e,isPaused:!0,timeLeft:i};await r({timerState:m})}}})}async function h(e){if(e.isActive&&e.isPaused&&e.timeLeft>0){const t=e.timeLeft/60;await r({timerState:{...e,isPaused:!1}}),chrome.alarms.create("mindfulnessTimer",{delayInMinutes:t})}}async function T(){await r({timerState:n}),chrome.alarms.clear("mindfulnessTimer")}async function u(){await r({timerState:{...n,isActive:!0,timeLeft:5*60,mode:"shortBreak",interval:5}}),chrome.alarms.create("mindfulnessTimer",{delayInMinutes:5})}chrome.alarms.onAlarm.addListener(async e=>{if(e.name==="mindfulnessTimer"){const t=await c(["notificationsEnabled","soundEnabled","timerState"]),{notificationsEnabled:a,soundEnabled:s}=t,i=t.timerState||n;if(i.isActive&&!i.isPaused){if(s&&g("complete"),a){const o=w(),m=`mindfulnessReminder-${d()}`;chrome.notifications.create(m,{type:"basic",iconUrl:chrome.runtime.getURL("icons/icon128.png"),title:"Time for a Mindful Break",message:`${o.text} â€” ${o.author}`,buttons:[{title:"Take Break"},{title:"Snooze"}],requireInteraction:!0})}await r({timerState:n})}}});chrome.notifications.onButtonClicked.addListener(async(e,t)=>{e.startsWith("mindfulnessReminder-")&&(t===0?(chrome.runtime.sendMessage({action:"takeBreak"}),chrome.notifications.clear(e)):t===1&&(chrome.notifications.clear(e),await u()))});function w(){const e=[{text:"Take a deep breath and relax.",author:"Unknown"},{text:"Stay present and mindful.",author:"Thich Nhat Hanh"},{text:"The present moment is filled with joy and happiness. If you are attentive, you will see it.",author:"Thich Nhat Hanh"},{text:"Mindfulness isn't difficult, we just need to remember to do it.",author:"Sharon Salzberg"}];return e[Math.floor(Math.random()*e.length)]}function g(e){new Audio(chrome.runtime.getURL(`sounds/${e}.mp3`)).play()}

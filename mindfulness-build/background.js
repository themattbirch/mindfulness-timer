import{s as i,g as n}from"./storage.js";const s={isActive:!1,isPaused:!1,timeLeft:15*60,mode:"custom",interval:15,isBlinking:!1};chrome.runtime.onInstalled.addListener(()=>{i({interval:15,soundEnabled:!0,theme:"light",soundVolume:50,autoStartTimer:!1,showQuotes:!0,quoteChangeInterval:60,selectedSound:"gentle-bell",timerMode:"custom",quoteCategory:"all",minimalMode:!1,timerState:s})});chrome.runtime.onMessage.addListener(async(e,a,t)=>{const r=(await n(["timerState"])).timerState||s;switch(e.action){case"startTimer":await c(e.interval,e.mode),t({status:"Timer started"});break;case"pauseTimer":await u(r),t({status:"Timer paused"});break;case"resumeTimer":await l(r),t({status:"Timer resumed"});break;case"resetTimer":await d(),t({status:"Timer reset"});break;case"snoozeTimer":await f(),t({status:"Timer snoozed for 5 minutes"});break;default:t({status:"Unknown action"})}return!0});async function c(e,a){const t={isActive:!0,isPaused:!1,timeLeft:e*60,mode:a,interval:e,isBlinking:!1};await i({timerState:t}),chrome.alarms.create("mindfulnessTimer",{delayInMinutes:e})}async function u(e){e.isActive&&!e.isPaused&&chrome.alarms.get("mindfulnessTimer",async a=>{if(a){const t=Date.now(),m=a.scheduledTime,r=Math.max(0,Math.floor((m-t)/1e3));if(await chrome.alarms.clear("mindfulnessTimer")){const o={...e,isPaused:!0,timeLeft:r};await i({timerState:o})}}})}async function l(e){if(e.isActive&&e.isPaused&&e.timeLeft>0){const a=e.timeLeft/60;await i({timerState:{...e,isPaused:!1}}),chrome.alarms.create("mindfulnessTimer",{delayInMinutes:a})}}async function d(){await i({timerState:s}),chrome.alarms.clear("mindfulnessTimer")}async function f(){await i({timerState:{...s,isActive:!0,timeLeft:5*60,mode:"shortBreak",interval:5,isBlinking:!1}}),chrome.alarms.create("mindfulnessTimer",{delayInMinutes:5})}chrome.alarms.onAlarm.addListener(async e=>{if(e.name==="mindfulnessTimer"){const t=(await n(["soundEnabled","timerState"])).timerState||s;t.isActive&&!t.isPaused&&(await i({timerState:s}),chrome.runtime.sendMessage({action:"timerCompleted"}))}});
